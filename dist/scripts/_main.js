"use strict";function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function _iterableToArray(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e)){for(var t=0,o=new Array(e.length);t<e.length;t++)o[t]=e[t];return o}}function init(){checkGetUserMedia(),bindEvents()}function bindEvents(){motionBtn.addEventListener("click",function(){console.log(this),this.classList.contains("started")?(this.classList.remove("started"),motionDetect=!1):(this.classList.add("started"),motionDetect=!0)}),video.addEventListener("canplay",_videoOnCanPlay),video.addEventListener("canplaythrough",_videOnLoad),popupBtn.addEventListener("click",function(){_startCapture()}),tracker.on("track",function(e){context.clearRect(0,0,canvas.width,canvas.height),e.data&&e.data.forEach(function(e){context.strokeStyle="white",context.strokeRect(e.x,e.y,e.width,e.height),context.font="11px Helvetica",context.fillStyle="#fff",context.fillText("x: "+e.x+"px",60,20),context.fillText("y: "+e.y+"px",60,40);svg.querySelector("#face"),document.createElementNS("http://www.w3.org/2000/svg","g"),document.createElementNS("http://www.w3.org/2000/svg","text"),document.createElementNS("http://www.w3.org/2000/svg","text")})})}function createInterface(){var e=0,t=7;generateStroke(e,t,13),setInterval(function(){var o=document.querySelector("#digits").querySelectorAll("g");document.querySelector("#js-faces-targets").classList.add("noise"),e+=15,setTimeout(function(){document.querySelector("#js-faces-targets").classList.remove("noise"),requestAnimationFrame(function(){document.querySelector("#digits").querySelectorAll("text").forEach(function(t){t.style.transform="translateY(-"+e+"px)"})}),generateStroke(t+1,t+1,parseInt(o[o.length-1].querySelector("text").getAttribute("y"))+15),o=document.querySelector("#digits").querySelectorAll("g"),o[o.length-1].querySelector("text").animate([{fill:"red"},{fill:"#000",offset:.333},{fill:"#fff"}],{duration:100,iterations:6}),t++},3e3)},6e3)}function generateStroke(e,t,o){for(var n=e;n<=t;n++){var a=svg.querySelector("#digits"),r=document.createElementNS("http://www.w3.org/2000/svg","g"),i=document.createElementNS("http://www.w3.org/2000/svg","text");i.setAttribute("x",0),i.setAttribute("y",o),i.textContent=n+" - "+makeRandomString(),r.appendChild(i),a.appendChild(r),o+=15}}function createAudio(e){var t=document.getElementById("audio"),o=t.getContext("2d"),n=t.width,a=t.height,r=window.AudioContext||window.webkitAudioContext,i=new r,c=i.createMediaStreamSource(e),s=i.createAnalyser(),d=i.createScriptProcessor(2048,1,1);c.connect(s),c.connect(d),d.connect(i.destination),s.fftSize=128;var l=s.frequencyBinCount,u=new Uint8Array(l);d.onaudioprocess=function(){s.getByteFrequencyData(u);var e=Math.max.apply(Math,_toConsumableArray(u)),t=(n-115)/24,r=[{max:3,from:0,to:12,name:"quiet",color:{r:0,g:71,b:13}},{max:7,from:12,to:20,name:"medium",color:{r:230,g:96,b:14}},{max:10,from:20,to:100,name:"loud",color:{r:255,g:0,b:0}}],i=e/t,c=Math.floor(i);requestAnimationFrame(function(){o.clearRect(0,0,n,a);for(var e,i=0,s=0;s<l;s++)e=u[s],o.fillStyle="rgb("+(e+100)+", 50, 50)",o.fillRect(i,a-25-e/2,t,e/2),i+=t+5;for(var d=0;d<c;d++){var f="yellow";r.forEach(function(e){c>=e.from&&c<=e.to&&(f="rgb("+e.color.r+","+e.color.g+","+e.color.b+")")}),o.fillStyle=f,o.fillRect(d*(t+5),a-20,t,20)}})}}function _videoOnCanPlay(){video.classList.remove("hidden")}function _videOnLoad(){video.play(),draw(video,context),popup.classList.add("hidden");var e=setTimeout(function t(){toImage(),e=setTimeout(t,1e4)},1e4)}function _startCapture(){navigator.getUserMedia?navigator.mediaDevices.getUserMedia({audio:!0,video:!0}).then(function(e){video.srcObject=e,videoInterface.classList.remove("hidden"),createInterface(),video.onloadedmetadata=function(e){video.play(),video.muted=!0},createAudio(e)}).catch(function(e){console.log(e.name+": "+e.message),fallBack.classList.remove("hidden")}):console.log("getUserMedia not supported")}function _pauseCapture(){video.pause()}function draw(e){context.drawImage(e,0,0,720,540),requestAnimationFrame(function(){draw(e),motionDetect&&console.log(context.getImageData(0,0,canvas.width,canvas.height))})}function toImage(){var e=document.getElementById("noise"),t=e.getContext("2d"),o=context.getImageData(0,0,canvas.width,canvas.height),n=function(e){t.putImageData(e,0,0)};e.classList.remove("hidden");var a=0,r=setInterval(function(){var t={amount:1,seed:Math.round(1e3*Math.random()),iterations:5,quality:30};a<10?(glitch(o,t,n),a++):(e.classList.add("hidden"),clearInterval(r),context.drawImage(video,0,0,720,540))},40)}function checkGetUserMedia(){navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia}function makeRandomString(){for(var e="",t=[],o="0123456789",n=[5,5,5],a=0,r=0;r<16;r++)e+=o.charAt(Math.floor(Math.random()*o.length));for(r in n){var i=n[r],c=e.substring(a,i+a);a=i;var s=c.lastIndexOf(";");s<0&&(s=c.lastIndexOf(" ")),t.push(c)}return t.join(" ")}var faseBtn=document.querySelector(".controls__button_face-detect"),motionBtn=document.querySelector(".controls__button_motion-detect"),popupBtn=document.querySelector(".popup__button"),popup=document.querySelector(".popup"),videoInterface=document.querySelector(".video-interface"),fallBack=document.querySelector(".video-fallback"),video=document.querySelector("video"),canvas=document.getElementById("canvas"),context=canvas.getContext("2d"),svg=document.querySelector("#js-faces-targets"),tracker=new tracking.ObjectTracker("face");tracker.setInitialScale(4),tracker.setStepSize(2),tracker.setEdgesDensity(.1);var motionDetect=!1;init();