"use strict";function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function _iterableToArray(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e)){for(var t=0,o=new Array(e.length);t<e.length;t++)o[t]=e[t];return o}}function init(){checkGetUserMedia(),bindEvents()}function bindEvents(){motionBtn.addEventListener("click",function(){this.classList.contains("started")?(this.classList.remove("started"),Motion.stop(),face.classList.add("hidden")):(this.classList.add("started"),Motion.start(),face.classList.remove("hidden"))}),faseBtn.addEventListener("click",function(){console.log(123),Motion.stop()}),video.addEventListener("canplay",_videoOnCanPlay),video.addEventListener("canplaythrough",_videOnLoad),popupBtn.addEventListener("click",_startCapture)}function createInterface(){var e=0,t=7;generateStroke(e,t,13),setInterval(function(){var o=document.querySelector("#digits").querySelectorAll("g");document.querySelector("#js-faces-targets").classList.add("noise"),e+=15,setTimeout(function(){document.querySelector("#js-faces-targets").classList.remove("noise"),requestAnimationFrame(function(){document.querySelector("#digits").querySelectorAll("text").forEach(function(t){t.style.transform="translateY(-"+e+"px)"})}),generateStroke(t+1,t+1,parseInt(o[o.length-1].querySelector("text").getAttribute("y"))+15),o=document.querySelector("#digits").querySelectorAll("g"),o[o.length-1].querySelector("text").animate([{fill:"red"},{fill:"#000",offset:.333},{fill:"#fff"}],{duration:100,iterations:6}),t++},3e3)},6e3)}function generateStroke(e,t,o){for(var n=e;n<=t;n++){var r=svg.querySelector("#digits"),a=document.createElementNS("http://www.w3.org/2000/svg","g"),i=document.createElementNS("http://www.w3.org/2000/svg","text");i.setAttribute("x",0),i.setAttribute("y",o),i.textContent=n+" - "+makeRandomString(),a.appendChild(i),r.appendChild(a),o+=15}}function createAudio(e){var t=document.getElementById("audio"),o=t.getContext("2d"),n=t.width,r=t.height,a=window.AudioContext||window.webkitAudioContext,i=new a,c=i.createMediaStreamSource(e),d=i.createAnalyser(),s=i.createScriptProcessor(2048,1,1);c.connect(d),c.connect(s),s.connect(i.destination),d.fftSize=128;var l=d.frequencyBinCount,u=new Uint8Array(l);s.onaudioprocess=function(){d.getByteFrequencyData(u);var e=Math.max.apply(Math,_toConsumableArray(u)),t=(n-115)/24,a=[{max:3,from:0,to:12,name:"quiet",color:{r:0,g:71,b:13}},{max:7,from:12,to:20,name:"medium",color:{r:230,g:96,b:14}},{max:10,from:20,to:100,name:"loud",color:{r:255,g:0,b:0}}],i=e/t,c=Math.floor(i);requestAnimationFrame(function(){o.clearRect(0,0,n,r);for(var e,i=0,d=0;d<l;d++)e=u[d],o.fillStyle="rgb("+(e+100)+", 50, 50)",o.fillRect(i,r-25-e/2,t,e/2),i+=t+5;for(var s=0;s<c;s++){var f="yellow";a.forEach(function(e){c>=e.from&&c<=e.to&&(f="rgb("+e.color.r+","+e.color.g+","+e.color.b+")")}),o.fillStyle=f,o.fillRect(s*(t+5),r-20,t,20)}})}}function _videoOnCanPlay(){video.classList.remove("hidden")}function _videOnLoad(){video.play(),draw(video,context),popup.classList.add("hidden");var e=setTimeout(function t(){toImage(),e=setTimeout(t,1e4)},1e4)}function _startCapture(){navigator.getUserMedia?navigator.mediaDevices.getUserMedia({audio:!0,video:!0}).then(function(e){video.srcObject=e,videoInterface.classList.remove("hidden"),createInterface(),video.onloadedmetadata=function(e){video.play(),video.muted=!0},createAudio(e)}).catch(function(e){console.log(e.name+": "+e.message),fallBack.classList.remove("hidden")}):console.log("getUserMedia not supported")}function draw(e){return context.drawImage(e,0,0,720,540),requestAnimationFrame(function(){draw(e)}),canvas}function toImage(){var e=document.getElementById("noise"),t=e.getContext("2d"),o=context.getImageData(0,0,canvas.width,canvas.height),n=function(e){t.putImageData(e,0,0)};e.classList.remove("hidden");var r=0,a=setInterval(function(){var t={amount:1,seed:Math.round(1e3*Math.random()),iterations:5,quality:30};r<10?(glitch(o,t,n),r++):(e.classList.add("hidden"),clearInterval(a),context.drawImage(video,0,0,720,540))},40)}function checkGetUserMedia(){navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia}function makeRandomString(){for(var e="",t=[],o="0123456789",n=[5,5,5],r=0,a=0;a<16;a++)e+=o.charAt(Math.floor(Math.random()*o.length));for(a in n){var i=n[a],c=e.substring(r,i+r);r=i;var d=c.lastIndexOf(";");d<0&&(d=c.lastIndexOf(" ")),t.push(c)}return t.join(" ")}var faseBtn=document.querySelector(".controls__button_face-detect"),motionBtn=document.querySelector(".controls__button_motion-detect"),popupBtn=document.querySelector(".popup__button"),popup=document.querySelector(".popup"),videoInterface=document.querySelector(".video-interface"),fallBack=document.querySelector(".video-fallback"),video=document.querySelector("video"),canvas=document.getElementById("canvas"),context=canvas.getContext("2d"),Motion=new MotionDetector.Core,svg=document.querySelector("#js-faces-targets"),face=document.getElementById("face"),ca=0;init();